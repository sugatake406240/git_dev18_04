<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Chatã‚¢ãƒ—ãƒª</title>
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã®ç”»é¢ã«è¦‹ãˆã‚‹å†…å®¹ -->

<main>
  <!-- <button id="remove" type="button">å‰Šé™¤ãƒœã‚¿ãƒ³</button> -->


<!-- ä½è—¤å› -->
  <section  class="sato_inputarea">
  <div  class="sato_title" >
    <img  class="person_img" src="imgs/buke.png" alt="" >
    <h1  style="margin-left: 20px;">ä½è—¤å›</h1>
    <!-- <input type="text" id="username"> -->
  </div>

  <div>
    <!-- ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
    <textarea name="" id="text_sato" cols="30" rows="10"></textarea>
  </div>
  <div>
    <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
    <button id="send_sato" >é€ä¿¡</button>
  </div>

</section>



<!-- é€šä¿¡è¡¨ç¤º -->
<section  class="messege" >
  <div>
    <h1 class="messege_title" >é€šä¿¡çŠ¶æ³ <br><p class="messege_title_comment" >â€»é–“é•ã£ãŸã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚¯ãƒªãƒƒã‚¯ã§å‰Šé™¤</p> </h1>
    <!-- <input type="text" id="username"> -->
    
    <div id="output"></div>
    
  </div>
</section>


<!-- éˆ´æœ¨å› -->
<section class="suzuki_inputarea" >
  <div  class="suzuki_title">
    <img   class="person_img" src="imgs/tuku.jpg" alt="" >
    <h1 style="margin-left: 20px;">éˆ´æœ¨å›</h1>
    <!-- <input type="text" id="username"> -->
  </div>

  <div>
    <!-- ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
    <textarea name="" id="text_suzuki" cols="30" rows="10"></textarea>

  </div>
  <div>
    <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
    <button id="send_suzuki" >é€ä¿¡</button>
  </div>

</section>

</main>

  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <!--** ä»¥ä¸‹Firebase **-->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <!-- firebaseã®verãŒå¤‰ã‚ã‚‹ã®ã§ã€æ•°å­—ãŒã©ã‚“ã©ã‚“å¤‰åŒ–ã—ã¾ã™ğŸ™‹â€â™€ï¸ -->
  <!-- ã“ã“ã«firebaseã®scriptã‚’è²¼ã‚Šä»˜ã‘ã‚‹ -->
  <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyAVDAnGEr4HfW4y1hDuK0P3I5aKA7ms85c",
      authDomain: "dev18-chat01-ec2c1.firebaseapp.com",
      databaseURL: "https://dev18-chat01-ec2c1.firebaseio.com",
      projectId: "dev18-chat01-ec2c1",
      storageBucket: "dev18-chat01-ec2c1.appspot.com",
      messagingSenderId: "787873825531",
      appId: "1:787873825531:web:06171ba8d5e10eb526e65e"
    };
    
    
    // 
    // Initialize Firebase
    // 
    firebase.initializeApp(firebaseConfig);


    // 
    //firebaseã®ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹ï¼ˆä¿å­˜ã•ã›ã‚‹å ´æ‰€ï¼‰ã‚’ä½¿ã„ã¾ã™ã‚ˆ
    // 
    const newPostRef = firebase.database().ref();

    // ã“ã“ã‹ã‚‰ä¸‹ã«jqueryã®å‡¦ç†ã‚’æ›¸ã„ã¦ç·´ç¿’ã—ã¾ã™

    // 
    // é€ä¿¡
    // 
    // ä½è—¤å›ã€€é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æ¬¡ã®å‡¦ç†ã‚’ã™ã‚‹
    $("#send_sato").on("click", function () {
      // ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§é€ã‚‹

      const date= new Date();
      const localtime=date.toLocaleString();
      console.log(localtime);


      newPostRef.push({
        // username: $("#username").val(), //åå‰
        username: "ä½è—¤", //åå‰
        text: $("#text_sato").val(), //ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
        time: localtime,
      })

      console.log("ä½è—¤ãã‚“ text"+$("#text_sato").val()+localtime);
      $("#text_sato").val(""); //ç©ºã«ã™ã‚‹
      // $("#username").val(""); //ç©ºã«ã™ã‚‹
    });

    // éˆ´æœ¨å›ã€€é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æ¬¡ã®å‡¦ç†ã‚’ã™ã‚‹
    $("#send_suzuki").on("click", function () {
      // ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§é€ã‚‹
      const date= new Date();
      const localtime=date.toLocaleString();
      console.log(localtime);

      newPostRef.push({
        // username: $("#username").val(), //åå‰
        username: "éˆ´æœ¨", //åå‰
        text: $("#text_suzuki").val(), //ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
        time: localtime,
      })
      
      console.log("éˆ´æœ¨ãã‚“ text"+$("#text_suzuki").val()+localtime);

      $("#text_suzuki").val(""); //ç©ºã«ã™ã‚‹
      // $("#username").val(""); //ç©ºã«ã™ã‚‹
    });

    // å—ä¿¡å‡¦ç†
    newPostRef.on("child_added",function (data) {
      let v = data.val(); //ã“ã“ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦å…¥ã£ã¦ãã‚‹
      let k = data.key;   //ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼å€¤ã‚’ä¿å­˜
      // console.log(v);  //vã®å¤‰æ•°ã«å…¥ã£ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…¨ã¦ã¿ã‚‹
      // console.log(k);

      // let str = `<div><p>${v.username}<br>${v.text}</p></div>`;
      let str;

      // ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ã‚’htmlã«åŸ‹ã‚è¾¼ã‚€
      if(v.username=="ä½è—¤"){
        console.log(v.username);
        str = `<p  id="${k}" class="out_sato sato_title"><img src="imgs/buke.png" width="38px" height="38px" alt=""   style="align-self: flex-start;">${v.username}  ${v.time}<br>${v.text} </p>`;
       
        $("#output").append(str);
      }
      else if(v.username=="éˆ´æœ¨"){
        console.log(v.username);
        str = `<p  id="${k}" class="out_suzuki suzuki_title"><img src="imgs/tuku.jpg"  width="38px" height="38px" alt="" style="align-self: flex-start;">${v.username}  ${v.time}<br>${v.text} </p>`;
       
        $("#output").append(str);
      }
    })

    $("#text").on("keydown", function (e) {
      console.log(e, "event");

      if (e.keyCode === 13) {
        newPostRef.push({
          username: $("#username").val(), //åå‰
          text: $("#text").val(), //ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
        })
        $("#text").val(""); //ç©ºã«ã™ã‚‹
        $("#username").val(""); //ç©ºã«ã™ã‚‹
      }
    })

  // });




// 
// 
// å‰Šé™¤å‡¦ç†
// 
// ID=outputã‚¨ãƒªã‚¢
// 
$(document).on('click', (event) => {
    const id = $(event.target).attr('id');
    // console.log(event.target);
    // console.log(id);
    if(id != null){
      firebase.database().ref(id).remove();
    }
    

    // å—ä¿¡å‡¦ç†
    $("#output").empty();  //ç”»é¢åˆæœŸåŒ–

    newPostRef.on("child_added",function (data) {
    let v = data.val(); //ã“ã“ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦å…¥ã£ã¦ãã‚‹
    let k = data.key;   //ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼å€¤ã‚’ä¿å­˜
    let str;

    // ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ã‚’htmlã«åŸ‹ã‚è¾¼ã‚€
      if(v.username=="ä½è—¤"){
        console.log(v.username);
        str = `<p  id="${k}" class="out_sato sato_title"><img src="imgs/buke.png" width="38px" height="38px" alt=""   style="align-self: flex-start;">${v.username}${v.time}<br>${v.text} </p>`;
        $("#output").append(str);
      }
      else if(v.username=="éˆ´æœ¨"){
        console.log(v.username);
        str = `<p  id="${k}" class="out_suzuki suzuki_title"><img src="imgs/tuku.jpg"  width="38px" height="38px" alt="" style="align-self: flex-start;">${v.username}${v.time}<br>${v.text} </p>`;
        $("#output").append(str);
      }
    })
});






  </script>

<!-- <script src="js/app.js"></script> -->
</body>

</html>